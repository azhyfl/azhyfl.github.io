<!DOCTYPE html>
<html>

<head>
    <title>Chess FEN to Board Conversion</title>
    <meta charset="utf-8" />
    <meta name="description" content="Converts a FEN string to a chess board." />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="./js/copy.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <style>
        @font-face {
            font-family: "Segoe UI Symbol";
            src: url('./fonts/seguisym.ttf') format("truetype");
        }
    </style>
</head>

<body>
    <div align="center">
        <div>
            <h1>Chess FEN to Board Conversion</h1>
            <p>Converts a FEN string to a chess board.</p>
            <p>For more information about FEN strings, see <a
                    href="https://en.wikipedia.org/wiki/Forsyth%E2%80%93Edwards_Notation">Forsyth–Edwards Notation</a>.
            </p>
        </div>
        <div><input id="fenInput" style="width: 73ch;" value="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR" />
            <select id="whiteAndBlackSelect">
                <option value="0">Black and white squares</option>
                <option value="1">Black and white squares (alt)</option>
                <option value="2">Black and white squares (alt 2)</option>
                <option value="3">Black and white squares (alt 3)</option>
            </select>
            &nbsp;&nbsp;&nbsp;&nbsp;
            <input id="onlyOneColor" type="checkbox" /> Only one color
            <select id="onlyOneColorSelect">
            </select>
        </div>
        <div id="fenDisplay" class="mb-4 mt-4" style="font-size:35px; font-family:'Segoe UI Symbol';"></div>
        <div>
            <button id="copyButton" class="btn btn-secondary">Copy to clipboard</button>
        </div>
    </div>

    <script>
        var result = '';
        const symbols = {
            'P': '♙', 'N': '♘', 'B': '♗', 'R': '♖', 'Q': '♕', 'K': '♔',
            'p': '♟', 'n': '♞', 'b': '♝', 'r': '♜', 'q': '♛', 'k': '♚'
        };

        const onlyOneColors = ['.', ' ', '...', '   '];
        const whitesAndBlacks = [['□', '■'], ['░', '▓'], ['░', '█'], ['▏▔', '█']];

        var whiteAndBlack = whitesAndBlacks[0];
        var differEmptyCells = true;
        var emptyCell = '.';

        function convertFENToBoard(fen, differEmptyCells = true, emptyCell = '.',
            whiteAndBlack = whitesAndBlacks[0]) {
            let result = '';

            const [w, b] = whiteAndBlack;

            const lines = fen.split('/');
            for (let i = 0; i < lines.length; i++) {
                var emptyCells = [];
                for (let k = 0; k < 8; k++) {
                    if (i % 2 == 0)
                        emptyCells.push(k % 2 == 0 ? w : b);
                    else
                        emptyCells.push(k % 2 == 0 ? b : w);
                }
                let line = '';
                let colInd = 0;
                for (let j = 0; j < lines[i].length; j++) {
                    if (isNaN(lines[i][j])) {
                        line += symbols[lines[i][j]];
                        colInd += 1;
                    } else {
                        if (differEmptyCells) {
                            line += emptyCells.slice(colInd, colInd + parseInt(lines[i][j])).join('');
                        } else {
                            line += emptyCell.repeat(parseInt(lines[i][j]));
                        }
                        colInd += parseInt(lines[i][j]);
                    }
                }
                result += line + '<br>';
            }

            document.getElementById('fenDisplay').innerHTML = result;
            return result.replace(/<br>/g, '\n');
        }

        const fen = 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR';
        result = convertFENToBoard(fen, true, '.', whiteAndBlack);

        $(document).ready(function () {
            $('#fenInput').focus();

            $('#fenInput').on('keyup', function (e) {
                if (e.keyCode == 13) {
                    $('#fenInput').blur();
                }
            });

            $('#fenInput').on('input', function () {
                result = convertFENToBoard($(this).val(), differEmptyCells, emptyCell, whiteAndBlack);
            });

            $('#copyButton').on('click', function () {
                copyTextToClipboard(result);
                //show a message that it was copied
                $('#copyButton').text('Copied!');
                setTimeout(function () {
                    $('#copyButton').text('Copy to clipboard');
                }, 2000);
            });

            $('#whiteAndBlackSelect').val(0);

            $('#whiteAndBlackSelect').on('change', function () {
                whiteAndBlack = whitesAndBlacks[$(this).val()];
                result = convertFENToBoard($('#fenInput').val(), differEmptyCells, emptyCell, whiteAndBlack);
            });

            $('#onlyOneColor').on('change', function () {
                if ($(this).is(':checked')) {
                    $('#onlyOneColorSelect').show();
                    $('#whiteAndBlackSelect').hide();
                    differEmptyCells = false;
                } else {
                    $('#onlyOneColorSelect').hide();
                    $('#whiteAndBlackSelect').show();
                    differEmptyCells = true;
                }
                result = convertFENToBoard($('#fenInput').val(), differEmptyCells, emptyCell, whiteAndBlack);
            });

            $('#onlyOneColor').prop('checked', false);

            $('#onlyOneColorSelect').on('change', function () {
                emptyCell = onlyOneColors[$(this).val()];
                result = convertFENToBoard($('#fenInput').val(), differEmptyCells, emptyCell, whiteAndBlack);
            });

            $('#onlyOneColorSelect').html(onlyOneColors.map(function (item, index) {
                return '<option value="' + index + '">' + item + '</option>';
            }));

            $('#onlyOneColorSelect').hide();
        });
    </script>
</body>

</html>